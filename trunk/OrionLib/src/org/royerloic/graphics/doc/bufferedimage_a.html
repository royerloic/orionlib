<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="generator" content="http://www.movabletype.org/">



<title>Chet Haase's Blog: BufferedImage as Good as Butter</title><link rel="stylesheet" href="bufferedimage_a_dateien/styles-site.css" type="text/css">
<link rel="stylesheet" href="bufferedimage_a_dateien/simple.css" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://weblogs.java.net/blog/chet/index.rdf">
<link rel="alternate" type="application/atom+xml" title="Atom" href="http://weblogs.java.net/blog/chet/atom.xml">

<link rel="start" href="http://weblogs.java.net/blog/chet/" title="Home">
<link rel="prev" href="http://weblogs.java.net/blog/chet/archive/2003/08/patterns_shmatt.html" title="Patterns, Shmatterns">

<link rel="next" href="http://weblogs.java.net/blog/chet/archive/2003/08/bufferedimage_a_1.html" title="BufferedImage as Good as Butter, Part II"></head>


<body>

<!--  Masthead  -->
<div>
<table style="background: transparent url(/images/header_new_bg.gif) repeat scroll 0%; -moz-background-clip: initial; -moz-background-origin: initial; -moz-background-inline-policy: initial;" border="0" cellpadding="0" cellspacing="0" height="25" width="100%">
<tbody><tr>
<td rowspan="2" width="100%"><a href="http://www.java.net/"><img src="bufferedimage_a_dateien/header_jnet.gif" alt="The Source for Java Technology Collaboration" border="0" height="53" width="520"></a></td>
 <td style="vertical-align: middle;" nowrap="nowrap">
 <div id="login">
 
  <form name="loginform" id="loginform" action="https://www.dev.java.net/servlets/TLogin" method="post">
  <input name="redir" value="http://weblogs.java.net/blog/chet/archive/2003/08/bufferedimage_a.html" type="hidden">
  <div>
  <strong>User:</strong>
   <input name="loginID" id="loginID" value="" size="7" maxlength="32" type="text">
   <strong>Password:</strong>

   <input name="password" id="password" value="" size="7" maxlength="32" type="password">
   <input name="Login" class="buttonred" id="Button" value="Login" type="submit"> </div>
  <div class="small" align="right"><strong> <a href="https://www.dev.java.net/servlets/Join">Register</a>  | <a href="https://www.dev.java.net/servlets/TLogin">Login help</a>   &nbsp;&nbsp;&nbsp;</strong></div> 
</form>
 
</div>
</td> 
</tr>
</tbody></table>
<div class="space"></div>

<!--  Tabs  -->


<noindex>
</noindex><div class="tabs" id="toptabs">
<table border="0" cellpadding="4" cellspacing="0">
<tbody>
<tr>
<td><a href="https://www.dev.java.net/servlets/StartPage">My       pages</a> </td>
<td><a href="http://community.java.net/projects/">Projects</a></td>
<td><a href="http://community.java.net/">Communities</a>   </td>
<th><a href="http://www.java.net/">java.net</a></th>
</tr></tbody></table></div>




<table id="main" border="0" cellpadding="2" cellspacing="2" width="100%">
  <tbody>
  <tr valign="top">
    <td id="leftcol" rowspan="2" width="150">
	<img src="bufferedimage_a_dateien/a_002.gif" height="1" width="150"><br>
<div id="navcolumn">
<!--   COMMUNITY LINKS   -->
<noindex>
</noindex><div class="toolgroup" id="communitylinks">
<div class="label"><strong>Get Involved</strong></div>
<div class="body">
<div><a href="https://java-net.dev.java.net/">java-net Project</a></div>
<div><a href="http://www.java.net/request_project.csp">Request a Project</a></div>
<div><a href="http://community.java.net/help_wanted/">Project&nbsp;Help&nbsp;Wanted&nbsp;Ads</a></div>
<div><a href="http://community.java.net/projects/publicize.csp">Publicize your Project</a></div>
<!-- <div><a href="#">Success Stories</a></div>  -->
<div><a href="http://today.java.net/cs/user/create/bl">Submit Content</a></div>
</div>
</div>

<div class="toolgroup" id="communitylinks">
<div class="label"><strong>Get Informed</strong></div>
<div class="body">
<div><a href="http://www.java.net/about.csp">About java.net</a></div>
<div><a href="http://today.java.net/pub/q/articles">Articles</a></div>
<div><a href="http://weblogs.java.net/">Weblogs</a></div>
<div><a href="http://today.java.net/today/news/">News</a></div>
<div><a href="http://www.java.net/events">Events</a></div>
<div><a href="http://today.java.net/today/alsotoday.csp">Also in Java Today</a></div>
<div><a href="http://safari.java.net/">java.net Online Books</a> <em><font color="#ff0000">New!</font></em></div>
<div><a href="http://today.java.net/today/archive/">java.net Archives</a></div>
</div>
</div>

<div class="toolgroup" id="communitylinks">
<div class="label"><strong>Get Connected</strong></div>
<div class="body">
<div><a href="http://forums.java.net/">java.net Forums</a></div>
<div><a href="http://wiki.java.net/">Wiki</a> and <a href="http://wiki.java.net/bin/view/Javapedia/WebHome">Javapedia</a></div>
<div><a href="http://wiki.java.net/bin/view/People/WebHome">People</a> and <a href="http://community.java.net/member_org/">Organizations</a></div>
<div><a href="http://community.java.net/jugs/listing.csp">Java User Groups</a></div>
<div><!--  <a href="https://java-net.dev.java.net/servlets/ProjectMailingListList">Newsletters</a> and  --><a href="http://today.java.net/pub/q/rsschannels">RSS Feeds</a></div>
</div>
</div>

<div class="toolgroup" id="communitylinks">
<div class="label"><b>Search</b></div>
<div class="body">
<form action="http://onesearch.sun.com/search/developers/index.jsp">
<input name="col" value="javanet" type="hidden">
<div><input name="qt" class="medium" size="14" onfocus="if( this.value==this.defaultValue ) this.value='';" value="" type="text">
<input class="buttonred" value=" » " border="0" type="submit"></div>
</form>
</div>
</div>


</div>
<br>
</td>
<td colspan="2" height="3"><img src="bufferedimage_a_dateien/a.htm" height="3" width="1"><br></td>
</tr>
<tr> 
<td width="10"><img src="bufferedimage_a_dateien/a.htm" height="1" width="10"></td>
<td valign="top" width="100%">




<div class="link-note">
<a href="http://weblogs.java.net/blog/chet/index.rdf"><img src="bufferedimage_a_dateien/rss_weblogs.gif" alt="Syndicate this blog (XML)" align="right" border="0" height="15" hspace="10" vspace="4" width="80"></a><br>
</div>



<img src="bufferedimage_a_dateien/chet_haase.jpg" alt="Chet Haase" align="left" border="0" height="68" hspace="6" vspace="3" width="99">




<h2><a href="http://weblogs.java.net/blog/chet/">Chet Haase's Blog</a></h2>

<div class="small" align="right">
<a href="http://weblogs.java.net/blog/chet/archive/2003/08/patterns_shmatt.html">«Patterns, Shmatterns</a> |

<a href="http://weblogs.java.net/blog/chet/">Main</a>
| <a href="http://weblogs.java.net/blog/chet/archive/2003/08/bufferedimage_a_1.html">BufferedImage as Good as Butter, Part II »</a>

</div>

<div class="grayline"></div>

<h3>BufferedImage as Good as Butter</h3>

<span class="ltcaption1">Posted by <b>chet</b> on August 14, 2003 at 01:59 PM | <a href="http://weblogs.java.net/blog/chet/archive/2003/08/bufferedimage_a.html#comments">Comments (4)</a>

</span>

<br><br>

<p>
Recently there was a brief discussion on the <a href="http://java.sun.com/products/java-media/2D/forDevelopers/interest_group.html">java2d interest list</a>.  We were talking about some of uses of BufferedImage and
someone replied to the group with their epiphany on these objects with
just a brief: "BufferedImage as good as butter!"
</p>
<p>
The Java2D team has spent the last few days trying to understand and
come to terms with this phrase.  Was it praise?  Irony?  Sarcasm?  An epigram?  A typo?
Does it mean that BufferedImage is yellow?  Or creamy?  Or that
it spreads well if left out of the fridge, but melts if it is
too hot outside?  Is it a condiment?  Does it go well with bread?
Is it a substitute for vegetable oil?
</p>
<p>
I have decided it was actually one of those opaque philosophical
phrases that you might see in a fortune cookie (albeit one that
you got from a very geeky restaurant).  I do not yet understand
its true meaning, but I hope to walk far enough on the path to
enlightenment to one day glean its essence.
</p>
<p>
In the meantime, I will arbitrarily choose one possible meaning for
the purposes of this article: BufferedImages are slick.
</p>
<p>
One of the things that we and our developers run up against again
and again (and again) is the vast array of possibilities when dealing
with images and image operations in our APIs.  In particular, confusion
appears to reign when developers first learned Java in the 1.0/1.1 days
(whose APIs are still working and prevalent in some browsers'
implementations
of Java) but they are now trying to apply that knowledge in the
current API and implementation.
</p>
<p>
So, for example, someone could easily assume that
ImageProducer/ImageConsumer
is still <i>the</i> way to deal with creating and using images.  Or that
PixelGrabber is a great way to get at the actual pixel data in an image.
Or that MediaTracker is a really cool way to ensure that an image
is loaded before you use it.
</p>
<p>
Then these developers run into the new (as of 1.4) ImageIO APIs and
wonder how they get from their Image to a BufferedImage.
</p>
<p>
Might we suggest, instead, trying to use BufferedImage for most, if
not all, of your condiment image needs.  There are very few situations
where you really want or need to use the old Image APIs and thus translating
between that world and the new world of BufferedImage is really unnecessary.
ImageProducer/Consumer is an interesting way of dealing with Images
that are coming over the net and won't arrive until some
nondeterministic time in the future, but if you have the image on
disk and simply want to load it in, that's a pile of work to go
through (and some pretty non-obvious API calls) just to
get your hands on the data.  Or if you want an image that you
can access the pixel data on, you can sure use PixelGrabber, but
wouldn't it make more sense to simply call get/setRGB on a BufferedImage?
Or if you want an offscreen image, wouldn't it be nice to
simply be able to create an image of a specific type (or one
compatible with the display) and simply give it the width and
height to use?
</p>
<p>
In particular, check out the simple commands like:
</p><blockquote>
<code>
	new BufferedImage(int width, int height, int type)
</code>
</blockquote>
that give you an image of the width/height/type you require,
synchronously (that is, after the method returns, that image does exist; no 
need to send it through MediaTracker to await its imminent arrival).  
You can then get at the data directly (getRGB,
setRGB), grab the Raster object (which allows more ways of getting
at the pixel data), get the ColorModel, and all sorts of other
complex and interesting stuff.  But you don't have to do anything complicated
with it to take advantage of this API; you can
just create that image, get the Graphics object, render to it, and
away you go.

<p>
Or how about:
</p><blockquote>
<code>
	GraphicsConfiguration.createCompatibleImage(int width, int height)
</code>
</blockquote>
This retuns an opaque BufferedImage (there is another variation in
which you can specify a non-opaque type) of the given width/height
that should be in the same format as the screen.  This means that
operations to/from the screen or other compatible images should
be optimized (and sometimes hardware accelerated).

<p>
Then there's always the entire ImageIO package, which deals
exclusively in BufferedImage objects.  Instead of using the
old Toolkit APIs to load an Image, you can use ImageIO to read
images of more varied types (such as PNG) which will then
return a BufferedImage.
</p>
<p>
And remember too that converting from one image type to another
is usually as easy as a simple copy command.  So, for example,
if you happen to have one of these old Image objects lying around
and you really want to get at the pixels, or use ImageIO, or
just revel in the power and glory of having a BufferedImage
representation of that image, you can always do something like this:
</p><blockquote>
<code>
                     // your other image type<br>
	Image img;<br>
<br>
                     // new, cool representation of that image, created by one<br>
                     // of the means above, with width/height equal to img's<br>
	BufferedImage bImg;<br>
<br>
                     // Get the Graphics object for the BufferedImage<br>
	Graphics g = bImg.getGraphics();<br>
<br>
                     // Copy the old image into the new BufferedImage object<br>
	g.drawImage(img, 0, 0, null);<br>
</code>
</blockquote>

<p>
So store it in the fridge, keep it out on the counter,
spread it on your favorite wheat products and applications;
BufferedImage is as good as butter ... and maybe even better.
</p>
<p>
<i>
ps: Did you notice I didn't touch on that hot "performance" topic
anywhere in this article?  Stay tuned for the next article, in which 
I'll talk about some of the performance implications and implementation
details of BufferedImages.
</i>
</p><p>

</p><div id="a000197more"><div id="more">

</div></div>

<br><br>
<div class="grayline"></div>

<a name="comments"></a>
<h5>Comments</h5>
<span class="small">Comments are listed in date ascending order (oldest first) | <a href="#post">Post Comment</a></span>
<br><br>

<ul>
<li>
<a name="563"></a>
<div id="c563">
<b>J2ME</b>
Us J2ME develpers already knew these tricks and this BufferedImage revelation :)


<p class="posted"><span class="ltcaption1">Posted by: shareme  on August 14, 2003 at 02:58 PM</span></p>
</div>
</li>
</ul>
<ul>
<li>
<a name="565"></a>
<div id="c565">
<b>Severe bottleneck</b>
One of the most common bottleneck's in code is when people use
BufferedImage badly. Generally you should avoid:
new BufferedImage(...)
in favor of the:
GraphicsConfiguration.createCompatibleImage(...);
since the type of BufferedImage you create is almost guaranteed to not
be the best choice for each platform and it can make a massive
difference in speed. Often you will only notice the speed hit when
moving to a different OS - typically OS X since INT_RGB types require a
lot of work to get them into a native format. This can really make your
app slow, but is a very simple change to restore performance.
Naturally, if you're not blitting to screen or some other device that
goes through the OS's imaging routines then it may avoid the slowdown
but I would always favor createCompatibleImage over new BufferedImage
until actual profilling data shows new BufferedImage is faster.
Otherwise yes, BufferedImage is in fact better than butter.
<p class="posted"><span class="ltcaption1">Posted by: ajsutton  on August 14, 2003 at 04:22 PM</span></p>
</div>
</li>
</ul>
<ul>
<li>
<a name="566"></a>
<div id="c566">
<b>Severe bottleneck</b>Agreed; unless you have a reason to use a
BufferedImage of a specific type, the best default for performance
purposes is definitely the BufferedImage provided by
createCompatibleImage(). Tune in next time for more performance info
about BufferedImages in current and future releases.
<p class="posted"><span class="ltcaption1">Posted by: chet  on August 14, 2003 at 06:01 PM</span></p>
</div>
</li>
</ul>
<ul>
<li>
<a name="567"></a>
<div id="c567">
<b>but when you render it...</b>it seems to me that ImageWriters are
singletons, and they are forced to be stateful by API. so your big
powerful server can only render one image at a time:
synchronized(writer){ writer.setOutput(...); writer.write(...); }
<p class="posted"><span class="ltcaption1">Posted by: zhong  on August 14, 2003 at 06:03 PM</span></p>
</div>
</li>
</ul>


<br><br>



<form method="post" action="http://weblogs.java.net/mt/comments" name="comments_form" onsubmit="if (this.bakecookie[0].checked) rememberMe(this)">
<input name="static" value="1" type="hidden">
<input name="entry_id" value="197" type="hidden">

<a name="post"></a>

<b>Only logged in users may post comments. <a href="http://weblogs.java.net/cs/user/login?x-redirect=http://weblogs.java.net/blog/chet/archive/2003/08/bufferedimage_a.html">Login Here</a>.</b>

<!--  TS: var-  -->
<!--  TS: cfg-  -->
<!--  TS: vars-  -->
<!--  TS: test -   -->

<!--  TS: cpt -   -->


</form>






<br>

<div class="footer" align="right">This work is licensed under a
<a href="http://creativecommons.org/licenses/by-nc-sa/2.0/">Creative Commons License</a>.<br>
<a href="http://creativecommons.org/licenses/by-nc-sa/2.0/"><img src="bufferedimage_a_dateien/somerights.gif" alt="Creative Commons License" border="0" height="31" hspace="2" vspace="2" width="88"></a>
</div>


<br>
<div id="powered" align="right">
<b>Powered by</b><br>
<a href="http://www.movabletype.org/">Movable Type 3.01D</a><br>    
</div>



</td></tr></tbody></table>

<!--  BEGIN VNV5 FOOTER   -->
<!--  BEGIN VNV5 FOOTER   -->
<table border="0" cellpadding="0" cellspacing="10" width="100%">
<tbody><tr>
<td>
&nbsp;<a href="http://today.java.net/pub/q/java_net_rss"><img src="bufferedimage_a_dateien/xml.gif" alt="XML" align="middle" border="0" height="14" width="36"></a>&nbsp;<b>java.net RSS</b><br>
<div class="grayline"></div>
<table class="vatop" border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td><img src="bufferedimage_a_dateien/a.gif" alt=" " border="0" height="1" width="190"><br>
<a href="http://www.sun.com/"><img src="bufferedimage_a_dateien/logo_sun_small.gif" alt=" " border="0" height="29" vspace="5" width="61"></a></td>
<td valign="top" width="60%">
<div class="footer">
<a href="https://java-net.dev.java.net/feedback.html">Feedback</a> &nbsp;|&nbsp;<a href="http://java.net/faq.csp">FAQ</a> &nbsp;|&nbsp;<a href="http://java.net/presscenter/">Press</a>&nbsp;|&nbsp;<a href="http://java.net/terms.csp">Terms of Participation</a><br>
<a href="http://www.sun.com/share/text/termsofuse.html">Terms of Use</a> &nbsp;|&nbsp;
<a href="http://www.sun.com/privacy/">Privacy</a> &nbsp;|&nbsp;
<a href="http://www.sun.com/suntrademarks/">Trademarks</a>&nbsp;|&nbsp;<a href="https://java-net.dev.java.net/sitemap.html">Site Map</a>
<br><span class="sp5">&nbsp;</span><br>
Your use of this web site or any of its content or software indicates your agreement to be bound by these <a href="http://java.net/terms.csp">Terms of Participation</a>.<br>
<span class="sp5">&nbsp;</span><br>
Copyright © 1995-2004 Sun Microsystems, Inc.
</div></td>
<td align="right" valign="top" width="40%"><div class="footer">
<a href="http://www.oreilly.com/"><img src="bufferedimage_a_dateien/montague_logo_oreilly.gif" alt="Oreilly Logo" border="0" height="19" width="74"></a><a href="http://www.collab.net/"><img src="bufferedimage_a_dateien/montague_logo_collabnet.gif" alt="Collabnet Logo" border="0" height="19" width="85"></a><br>
Powered by Sun Microsystems, Inc.,<br> O'Reilly and CollabNet
</div></td></tr>
<!--  <tr><td colspan="3" valign="top" class="grey3"><img src="/im/a.gif" width="1" height="2" border="0" alt=" " /></td></tr>  -->
</tbody></table>
<div class="grayline"></div>
</td></tr>
</tbody></table>
<!--  END VNV5 FOOTER  -->



</div></body></html>